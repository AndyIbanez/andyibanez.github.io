<!doctype html><html prefix="og: http://ogp.me/ns#" lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,user-scalable=no"><meta http-equiv=x-ua-compatible content="ie=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=G-CE7T69YX8Y"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CE7T69YX8Y")}</script><link rel=apple-touch-icon sizes=180x180 href=https://www.andyibanez.com/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png sizes=32x32 href=https://www.andyibanez.com/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.andyibanez.com/favicons/favicon-16x16.png><link rel=manifest href=https://www.andyibanez.com/favicons/site.webmanifest><link rel=mask-icon href=https://www.andyibanez.com/favicons/safari-pinned-tab.svg color=#292148><meta name=msapplication-TileColor content="#292148"><meta name=msapplication-config content="https://www.andyibanez.com/favicons/browserconfig.xml"><meta name=theme-color content="#292148"><link rel=canonical href=https://www.andyibanez.com/posts/common-cryptographic-operations-with-cryptokit/><link rel=alternate hreflang=en href=https://www.andyibanez.com/posts/common-cryptographic-operations-with-cryptokit/ title><meta name=description content="Learn to implement basic cryptography with CryptoKit in Swift."><meta name=author content><meta name=theme-color content="#292148"><meta itemprop=name content="Common Cryptographic Operations With CryptoKit"><meta itemprop=description content="Learn to implement basic cryptography with CryptoKit in Swift."><meta itemprop=datePublished content="2019-10-09T07:00:00-04:00"><meta itemprop=dateModified content="2019-10-09T07:00:00-04:00"><meta itemprop=wordCount content="1675"><meta itemprop=keywords content="swift,cryptokit,ios,tvos,ipados,watchos,wwdc2019"><meta property="og:url" content="https://www.andyibanez.com/posts/common-cryptographic-operations-with-cryptokit/"><meta property="og:site_name" content="Andy Ibanez"><meta property="og:title" content="Common Cryptographic Operations With CryptoKit"><meta property="og:description" content="Learn to implement basic cryptography with CryptoKit in Swift."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-09T07:00:00-04:00"><meta property="article:modified_time" content="2019-10-09T07:00:00-04:00"><meta property="article:tag" content="Swift"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Apple"><meta property="article:tag" content="Ios"><meta property="article:tag" content="Ipados"><meta property="article:tag" content="Macos"><meta name=twitter:card content="summary"><meta name=twitter:title content="Common Cryptographic Operations With CryptoKit"><meta name=twitter:description content="Learn to implement basic cryptography with CryptoKit in Swift."><meta name=twitter:creator content="@"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","url":"https://www.andyibanez.com/posts/common-cryptographic-operations-with-cryptokit/","headline":"Common Cryptographic Operations With CryptoKit","description":"Learn to implement basic cryptography with CryptoKit in Swift.","datePublished":"2019-10-09","keywords":"swift,programming,apple,ios,ipados,macos,tvos,watchos,cryptokit,wwdc2019","author":{"@type":"Person","name":""}}</script><title>Common Cryptographic Operations With CryptoKit - Andy Ibanez</title><link rel=stylesheet href=https://www.andyibanez.com/style.main.min.18f604b90ed15864d7faa967f1ef9eacb99e1c967eff38762ec29b7bf1ab5876.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-CE7T69YX8Y"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CE7T69YX8Y")}</script></head><body><div class=wrapper><nav><div class=container><div class=language-selector></div></div></nav><header><div class=container><div class=header-group><div class=header-logo-container><a class=header-logo-link href=https://www.andyibanez.com/><img class=header-logo-circle src=https://www.andyibanez.com/img/andy_profile.png alt="Andy Ibanez logo"></a></div><div class=header-title><a href=https://www.andyibanez.com/>Andy Ibanez</a></div></div></div></header><nav><div class=container><div class=main-navigation><a href=/about/>About Me</a><a href=/posts/>Blog</a><a href=/projects/>Projects</a><a href=/tags/>Tags</a><a href=/contact/>Contact</a><a href=/privacy-policy/>Privacy policy</a></div></div></nav><div class=container><div class=search><input type=text id=searchInput placeholder="Type here to search"></div><div class="container search-results-container" hidden=true><div id=searchResults class=search-results></div></div></div><main><div class=container><article><h1 class=title>Common Cryptographic Operations With CryptoKit</h1><p class=publish>Published on
<time class=post-date datetime=2019-10-09T07:00:00-04:00>October 9, 2019</time></p><p>Apple has always taken security very seriously, so it&rsquo;s expected that they would provide developers with the same tools they have to help developers implement the same security measures in their apps. This year, Apple introduced <code>CryptoKit</code>.</p><p>Apple providing new cryptography tools is nothing new. They have provided the <code>Security</code> framework for a <em>very</em> long time, and a few years later they introduced <code>CommonCrypto</code>. The problem with these frameworks is that they can be very low level, being written in C, and it can be intimidating for new developers to adopt them in their project. <code>CryptoKit</code> abstracts a lot of the details and it provides easier interfaces for common operations such as hashing, encrypting, and even signing.</p><p>In this article we will explore how to do common cryptographic operations with CryptoKit, and the downsides it currently has.</p><h1 id=introduction-to-cryptokit>Introduction to CryptoKit</h1><p><code>CryptoKit</code> is a cryptography framework for Apple&rsquo;s platforms written in Swift. It provides easy and convenient interfaces for cryptographic operations in a safe and high-level manner. You no longer have to worry about managing pointers or other low-level concepts that just don&rsquo;t exist in Swift. You also don&rsquo;t have to do manual memory management.</p><p>CryptoKit allows you to:</p><ul><li>Compute and compare hashes.</li><li>Work with Public-Key cryptography to create and evaluate digital signatures and do key exchange.</li><li>Work with symmetric cryptography to do message authentication and encryption.</li></ul><h1 id=common-cryptographic-operations-with-cryptokit>Common Cryptographic Operations with CryptoKit</h1><h2 id=hashing>Hashing</h2><p>To perform hashing, <code>CryptoKit</code> provides the <a href=https://developer.apple.com/documentation/cryptokit/hashfunction><code>HashFunction</code></a> protocol, along with three implementations of it. At the time of this writing, said implementations are the following structs:</p><ul><li>SHA256</li><li>SHA384</li><li>SHA512</li></ul><p>They are all used similarly. They all have a static method that takes a <code>DataProtocol</code> of what you want to hash.</p><p>For example, to perform a SHA256:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>data</span> = string.data(using: .utf8)<span style=color:#89dceb;font-weight:700>!</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>hash</span> = SHA256.hash(data: data)
</span></span></code></pre></div><p>This will return the hash as a <code>SHA256.Digest</code> object, which is actually a collection</p><p>If you want to get the string representation of this hash, you do this:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>stringHash</span> = hash.<span style=color:#89dceb>map</span> { <span style=color:#89dceb>String</span>(format: <span style=color:#a6e3a1>&#34;%02hhx&#34;</span>, <span style=color:#f5e0dc>$0</span>) }.joined()
</span></span></code></pre></div><hr><p><strong>Important Note!</strong></p><p>You may have seen (and maybe even been tempted by) people grabbing the hash using the <code>description</code> property of the digest.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#89dceb>print</span>(hash.description)
</span></span></code></pre></div><p>This is because the property prints something like this:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>SHA256 digest: ae7ffb85a76d5810c70c2459415e02b26a556e6d02ef76449690c1459232ffa9
</span></span></code></pre></div><p>This is not safe, because Apple can change how the <code>description</code> property returns the information about the hash in a future release. In general, you should never rely on this property to get any long-lasting data. You should only use it when debugging.</p><p>As a recent example of this, Apple recently changed what the <code>description</code> property of <code>Data</code> objects returns. Developers were using it as a quick way to get the textual representation of a push notification token, and Apple changed it to return the size of the data instead. This caused a lot of broken push notifications in a lot of apps.</p><hr><p>For the sake of comparison, this is how I calculated a <code>SHA512</code> hash prior to iOS 13 in Swift:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>  <span style=color:#f38ba8>func</span> <span style=color:#89b4fa>iOS10Sha512</span>(data: Data) -&gt; Data {
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>digest</span> = NSMutableData(length: <span style=color:#89dceb>Int</span>(CC_SHA512_DIGEST_LENGTH))<span style=color:#89dceb;font-weight:700>!</span>
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>value</span> = data <span style=color:#cba6f7>as</span> NSData
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>uint8Pointer</span> = <span style=color:#89dceb>UnsafeMutablePointer</span>&lt;<span style=color:#89dceb>UInt8</span>&gt;.allocate(capacity: digest.length)
</span></span><span style=display:flex><span>    CC_SHA512(value.bytes, CC_LONG(data.<span style=color:#89dceb>count</span>), uint8Pointer)
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>return</span> value <span style=color:#cba6f7>as</span> Data
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><p>All the aforementioned hashes are used the same way. If you need to use deprecated hash algorithms but are still popular today (such as <code>MD5</code>), Apple provides them in an <code>Insecure</code> enum.</p><p>To calculate the MD5 hash of a piece of data with CryptoKit:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>md5</span> = Insecure.MD5.hash(data: data)
</span></span></code></pre></div><p>You can also find the <code>SHA1</code> algorithm within <code>Insecure</code>.</p><h2 id=symmetric-encryption>Symmetric Encryption</h2><p>With CryptoKit, when you encrypt a piece of data not only will get you confidentiality of your message, but also authenticity.</p><p>CryptoKit provides two symmetric cyphers: <code>AES-GCM</code> and <code>ChaChaPoly</code>.</p><p>Their usage is once again very straightforward and you don&rsquo;t have to concern yourself with the low-level implementation details.</p><p>The return type of the <code>seal</code> method is a <code>AES.GCM.SealedBox</code> object which contains information about the box. A few important properties:</p><ul><li>A <code>ciphertext</code>, which is the encrypted data with the same size as the input data.</li><li>A <code>tag</code>, which ensures the content cannot be tampered with in a way you would not notice.</li><li>A <code>nonce</code>, which is a random number to add entropy to the encrypted data.</li></ul><p>If you need to share the data with somebody else, you can use the <code>combined</code> property which combines all the previous properties into one. Then they can decrypt this data using the same key.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>combinedData</span> = sealedBox.combined! <span style=color:#6c7086;font-style:italic>// Previous sealed box</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>sealedBoxToOpen</span> = <span style=color:#cba6f7>try</span>! AES.GCM.SealedBox(combined: combinedData)
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>decryptedData</span> = <span style=color:#cba6f7>try</span>! AES.GCM.open(sealedBoxToOpen, using: passwordKey)
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>decryptedString</span> = <span style=color:#89dceb>String</span>(data: decryptedData, encoding: .utf8)<span style=color:#89dceb;font-weight:700>!</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>print</span>(decryptedString) <span style=color:#6c7086;font-style:italic>// &#34;The Legend of Zelda&#34;</span>
</span></span></code></pre></div><h2 id=signing-and-verifying-signed-content>Signing and Verifying Signed Content</h2><p>CryptoKit can help you sign and verify the signature of data.</p><p>CryptoKit comes with four different elliptic curve types:</p><ul><li><code>Curve25519</code></li><li><code>P521</code></li><li><code>P384</code></li><li><code>P256</code></li></ul><p>We will see how to use P521, and you will be able to use the others with these examples.</p><h3 id=generating-key-pairs>Generating Key Pairs</h3><p>Public-Key cryptography works with private and public keys, so we will start generating those.</p><pre tabindex=0><code>let privateKey = P521.Signing.PrivateKey()
let publicKey = privateKey.publicKey
let publicKeyData = publicKey.rawRepresentation //You can share this one with others
</code></pre><p>The <code>P521.Signing.PrivateKey</code> object wraps both the private key and public key, and they both have a <code>Data</code> representation that you can use to share (though you shouldn&rsquo;t share the private key with anyone, but you can use the data representation if you want to store it in a different way). You can convert these representations to Base64 encoded strings to make them easier to share, like posting them on your websites or sharing them in social media.</p><h3 id=signing>Signing</h3><p>Dealing with signing is much, much easier than doing it with the earlier APIs (and I tell you this from personal experience!)</p><h4 id=creating-signatures>Creating Signatures</h4><p>Signing is a very simple affair, and so is verifying signatures.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>signature</span> = <span style=color:#cba6f7>try</span>! privateKey.signature(<span style=color:#cba6f7>for</span>: data)
</span></span></code></pre></div><p>There&rsquo;s two variations of the <code>signature</code> method: One for data, and one for digests, which is what you would normally want to do. If you have a digest generated with CryptoKit&rsquo;s <code>SHA256</code>, <code>SHA384</code>, <code>SHA512</code>, or even an insecure algorithm, you can sign it directly with the overloaded method.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>hash</span> = SHA256.hash(data: data)
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>digestSignature</span> = <span style=color:#cba6f7>try</span>! privateKey.signature(<span style=color:#cba6f7>for</span>: hash)
</span></span></code></pre></div><h4 id=verifying-signatures>Verifying Signatures</h4><p>Just like is the case with signing, there&rsquo;s two overloaded methods for signature verification: One for a <code>DataProtocol</code>, and another one for a digest.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#cba6f7>if</span> publicKey.isValidSignature(signature, <span style=color:#cba6f7>for</span>: data) {
</span></span><span style=display:flex><span>  <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;Valid signature&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr>**Important Note!**<p>Not all cyphers have signing methods for both digests and data. Curve25519 only exposes signing methods for <code>DataProtocol</code>s.</p><hr><h3 id=key-agreement>Key Agreement</h3><p>Key agreement is a method used for multiple parties to securely choose a shared encryption key that can be used for signing and encrypting the data they want to share between each other.</p><p>Start by choosing a random salt.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>randomData</span>(length: <span style=color:#89dceb>Int</span>) -&gt; Data {
</span></span><span style=display:flex><span>  <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>data</span> = Data(<span style=color:#89dceb>count</span>: length)
</span></span><span style=display:flex><span>  <span style=color:#fab387>_</span> = data.withUnsafeMutableBytes {
</span></span><span style=display:flex><span>    SecRandomCopyBytes(kSecRandomDefault, length, <span style=color:#f5e0dc>$0</span>.baseAddress!)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>return</span> data
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>salt</span> = randomData(length: <span style=color:#fab387>32</span>) <span style=color:#6c7086;font-style:italic>// 256bits</span>
</span></span></code></pre></div><p>If you don&rsquo;t want to drop down to CommonCrypto to generate a random salt, you can create a new <code>SymmetricKey</code> of 256bits, and than grab its raw bytes to use it as a salt.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>symKeySalt</span> = SymmetricKey(size: .bits256)
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>salt</span> = symKeySalt.withUnsafeBytes { Data(<span style=color:#f5e0dc>$0</span>) }
</span></span></code></pre></div><p>After a salt has been generated, all the interested parties need to share their public keys with each other.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>alicePrivateKey</span> = P521.KeyAgreement.PrivateKey()
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>alicePublicKey</span> = alicePrivateKey.publicKey
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>eileenPrivateKey</span> = P521.KeyAgreement.PrivateKey()
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>eileenPublicKey</span> = eileenPrivateKey.publicKey
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>/// Alice sends her public key to Eileen</span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>/// Eileen sends her public key to Alice</span>
</span></span></code></pre></div><p>Now, all the parties have the relevant public keys.</p><p>Then, all the parties need to do is derive a secret using their own private key and the public key of the people they want to talk with. Once they have that shared secret, they can get the symmetric key.</p><p>All parties should derive the same symmetric key, and later they can start sharing data encrypted using this key.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#6c7086;font-style:italic>// Alice derives the shared secret and key.</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>aliceSharedSecret</span> = <span style=color:#cba6f7>try</span>! alicePrivateKey.sharedSecretFromKeyAgreement(with: eileenPublicKey)
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>aliceSymmetricKey</span> = aliceSharedSecret.hkdfDerivedSymmetricKey(using: SHA256.<span style=color:#fab387>self</span>, salt: salt, sharedInfo: Data(), outputByteCount: <span style=color:#fab387>32</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>// Eileen derives the shared secret and key.</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>eileenSharedSecret</span> = <span style=color:#cba6f7>try</span>! eileenPrivateKey.sharedSecretFromKeyAgreement(with: alicePublicKey)
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>eileenSymmetricKey</span> = eileenSharedSecret.hkdfDerivedSymmetricKey(using: SHA256.<span style=color:#fab387>self</span>, salt: salt, sharedInfo: Data(), outputByteCount: <span style=color:#fab387>32</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>if</span> aliceSymmetricKey == eileenSymmetricKey {
</span></span><span style=display:flex><span>  <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;The keys are equal and now they can share data&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And said encryption can be done with the two algorithms we saw before: Either AES-GCM or ChaCha20. To show this we will simulate a simple chat between Alice and Eileen:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#6c7086;font-style:italic>// Alice sends a message to Eileen</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>message</span> = <span style=color:#a6e3a1>&#34;Hi Eileen!&#34;</span>.data(using: .utf8)<span style=color:#89dceb;font-weight:700>!</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>encryptedByAlice</span> = <span style=color:#cba6f7>try</span> ChaChaPoly.seal(message, using: aliceSymmetricKey)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#6c7086;font-style:italic>// Eileen reads Alice&#39;s message.</span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>decryptedMessage</span> = <span style=color:#cba6f7>try</span>! ChaChaPoly.open(encryptedByAlice, using: eileenSymmetricKey)
</span></span><span style=display:flex><span><span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>decryptedMessageString</span> = <span style=color:#89dceb>String</span>(data: decryptedMessage, encoding: .utf8)<span style=color:#89dceb;font-weight:700>!</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>print</span>(decryptedMessageString) <span style=color:#6c7086;font-style:italic>// Hi Eileen!</span>
</span></span></code></pre></div><p>You can send a different salt each time a new message is generated as to keep it unique, and I encourage you to do so. If you are starting with CryptoKit, feel free to use a hard coded salt, but don&rsquo;t use it in a real application.</p><h1 id=the-downsides>The Downsides</h1><p>Currently, CryptoKit doesn&rsquo;t have much support for some popular encryption algorithms. While I wouldn&rsquo;t expect Apple to implement TwoFish or Serpent anytime soon, I was surprised when I saw we couldn&rsquo;t derive RSA keys. CryptoKit is really nice though, so I&rsquo;m sure the encryption suites it supports will just grow in the future.</p><h1 id=conclusion>Conclusion</h1><p>CryptoKit is a new and modern Cryptography framework for Apple&rsquo;s platforms. It is very high level, which makes it very easy to use. It supports a good set of cryptography algorithms you&rsquo;d expect to find in any other library. It supports the most basic operations like hashing, encryption, and even key derivation and sharing. It&rsquo;s a very powerful and simple framework despite it&rsquo;s lack of other popular algorithms. I personally have high hopes for its future, and it was one of my favorite surprises of this year&rsquo;s WWDC.</p><hr>**Important Note!**<p>In this article, I took a lot of liberties with the force-unwrapping and <code>try!</code>. With CryptoKit you should always deal with these operations in a safe manner.</p><hr></article></div></main><footer><div class=container><div class=footer-navigation><a href=https://github.com/AndyIbanez><span class=inline-svg><svg viewBox="0 0 42 40" id="svg4" width="42" height="40"><path fill="currentColor" d="m14.20936 32.20794c0 .16542-.19024.29776-.4301.29776-.27295.0248-.46319-.10752-.46319-.29776.0-.16542.19024-.29776.4301-.29776.24814-.0248.46319.10752.46319.29776zm-2.57234-.3722c-.0579.16542.10753.35566.35566.40528.21505.0827.46319.0.51282-.16542.0496-.16542-.10753-.35566-.35566-.4301-.21505-.0579-.45492.0248-.51282.19024zm3.65586-.14061c-.23986.0579-.40529.21505-.38047.40528.0248.16543.23986.27295.488.21505.23986-.0579.40528-.21505.38047-.38047-.0248-.15715-.24813-.26468-.488-.23986zM20.73531-.19734273e-6C9.2632-.19734273e-6.48748 8.7095398.48748 20.18166c0 9.17273 5.77328 17.02207 14.01964 19.78464 1.05871.19024 1.43091-.46319 1.43091-1.00081.0-.51282-.0248-3.34156-.0248-5.0785.0.0-5.78982 1.24067-7.00568-2.46481.0.0-.94292-2.40691-2.29939-3.02725.0.0-1.8941-1.29857.13234-1.27376.0.0 2.05952.16542 3.19267 2.13396 1.81139 3.19267 4.84691 2.27457 6.02969 1.72868.19023-1.32339.72786-2.24149 1.32338-2.78739-4.62358-.51281-9.28852-1.18278-9.28852-9.13964.0-2.27458.62861-3.416 1.95199-4.87172-.21505-.53763-.9181-2.7543.21506-5.6161302 1.72867-.53762 5.7071 2.2332202 5.7071 2.2332202 1.65424-.46319 3.43254-.70305 5.1943-.70305 1.76176.0 3.54006.23986 5.1943.70305.0.0 3.97843-2.7791202 5.7071-2.2332202 1.13315 2.8701002.4301 5.0785002.21505 5.6161302 1.32339 1.46399 2.13397 2.60542 2.13397 4.87172.0 7.98168-4.87172 8.61856-9.49531 9.13964.76095.65342 1.4061 1.8941 1.4061 3.83782.0 2.78739-.0248 6.23647-.0248 6.9147.0.53763.38047 1.19105 1.43091 1.00082 8.27117-2.74603 13.87903-10.59537 13.87903-19.7681C41.51252 8.7095398 32.20745-.19734273e-6 20.73533-.19734273e-6zM8.52706 28.52727c-.10752.0827-.0827.27295.0579.4301.13234.13234.32258.19024.4301.0827.10753-.0827.0827-.27295-.0579-.4301-.13233-.13234-.32257-.19024-.4301-.0827zM7.63378 27.8573c-.0579.10753.0248.23987.19023.32258.13234.0827.29777.0579.35566-.0579C8.23757 28.01446 8.15487 27.88212 7.98944 27.7994 7.82401 27.7498 7.69168 27.7746 7.63378 27.8573zm2.67986 2.94454c-.13234.10753-.0827.35566.10752.51281.19024.19024.4301.21505.53763.0827.10752-.10752.0579-.35566-.10753-.51281-.18196-.19024-.4301-.21505-.53762-.0827zM9.37072 29.58598c-.13234.0827-.13234.29776.0.488.13234.19023.35566.27295.46319.19023.13234-.10752.13234-.32257.0-.51281-.1158-.19024-.33085-.27295-.46319-.16542z" id="path2" style="stroke-width:.08271171"/></svg>
</span></a><a href=https://x.com/AndyIbanezK><span class=inline-svg><svg viewBox="0 0 50 40" id="svg4" width="50" height="40"><path fill="currentColor" d="m44.56253 9.96871c.0313.43748.0313.87506.0313 1.31254C44.59383 24.62494 34.43764 40 15.87508 40 10.1563 40 4.84383 38.34368.37506 35.4688c.81253.0937 1.5937.12495 2.4375.12495 4.71867.0 9.06249-1.5937 12.53125-4.31245-4.43751-.0938-8.15627-3.00003-9.43754-7.00006.62505.0937 1.25001.15622 1.90632.15622.90622.0 1.81254-.12505 2.65624-.34369C5.84384 23.15619 2.37498 19.09373 2.37498 14.18748v-.12495c1.3437.75 2.90633 1.21875 4.56246 1.28117-2.71876-1.81253-4.49993-4.90624-4.49993-8.40627.0-1.87497.4999-3.59372 1.37496-5.09373 4.96877 6.125 12.43756 10.12493 20.81248 10.56251-.15622-.75001-.25-1.53118-.25-2.31245C24.37495 4.5312 28.87498.0 34.46871.0c2.90623.0 5.53121 1.21875 7.37501 3.1875 2.28118-.43748 4.46867-1.28127 6.40626-2.43749-.75011 2.3438-2.34381 4.31255-4.43751 5.56246 2.03127-.21864 4.00003-.78126 5.81247-1.56244-1.37477 1.99992-3.09362 3.7811-5.06237 5.21868z" id="path2" style="stroke-width:.09619153"/></svg>
</span></a><a href=https://www.linkedin.com/in/andyibanez/><span class=inline-svg><svg viewBox="0 0 41 40" id="svg4" width="41" height="40"><path fill="currentColor" d="M9.45332 40H1.16028V13.29405H9.45332zM5.30234 9.65111c-2.65185.0-4.80279-2.19648-4.80279-4.84832a4.80279 4.80279.0 019.60558.0c0 2.65184-2.15184 4.84832-4.80279 4.84832zM40.49152 40H32.21633V26.99971c0-3.09828-.0625-7.07159-4.3117-7.07159-4.3117.0-4.97243 3.36615-4.97243 6.84837V40H14.64808V13.29405h7.95375v3.64294h.11608c1.10716-2.09827 3.81169-4.3126 7.8466-4.3126 8.39304.0 9.93594 5.52691 9.93594 12.70564V40z" id="path2" style="stroke-width:.08928771"/></svg>
</span></a><a href=https://www.andyibanez.com/posts/index.xml><span class=inline-svg><svg viewBox="0 0 40 40" id="svg4" width="40" height="40"><path fill="currentColor" d="m11.435816 34.282008c0 3.15793-2.5599899 5.71793-5.7179299 5.71793s-5.717840022654-2.56-5.717840022654-5.71793c0-3.15794 2.559990022654-5.71793 5.717930022654-5.71793s5.7178399 2.56008 5.7178399 5.71793zm15.68388 4.21873C26.373806 24.697208 15.317496 13.626978 1.4992361 12.880288.68361608 12.836188.46077346e-4 13.491538.46077346e-4 14.308318v4.29186c0 .75134.579460002654 1.38142 1.329190022654 1.43017 9.9849699.65036 17.9886099 8.63408 18.6402999 18.6403.0488.74973.67893 1.3292 1.43018 1.3292h4.29186c.81687 9e-5 1.47223-.68348 1.42812-1.49911zm12.87933.0257C39.249566 17.649718 22.452206.754048 1.4735261.00092799867.66727608-.027972.46077346e-4.623338.46077346e-4 1.430038v4.29177c0 .77008.610270002654 1.39687 1.379730022654 1.42848 17.0694999.6999 30.7701699 14.40316 31.4699899 31.46999.0315.76946.6583 1.37972 1.42848 1.37972h4.29177c.8066-8e-5 1.45794-.66731 1.42901-1.47356z" id="path2" style="stroke-width:.08928544"/></svg>
</span></a><a href=https://www.andyibanez.com/contact><span class=inline-svg><svg viewBox="0 0 40 40" id="svg4" width="40" height="40"><path fill="currentColor" d="m39.99999 36.249999c0 2.0711-1.6789 3.75-3.74999 3.75H3.75c-2.07109.0-3.74999-1.6789-3.74999-3.75v-20.56843a3.7499996 3.7499996.0 011.43648-2.95125c1.94633-1.5257 3.55476-2.7628904 12.82812-9.4930404C15.57906 2.2789186 18.18727-.02709136 20 .00024864227 21.81234-.02745136 24.42156 2.2793086 25.73539 3.2371986c9.27242 6.72945 10.88304 7.9683604 12.82812 9.4931204a3.7499996 3.7499996.0 011.43648 2.95125zm-5.13015-15.35976c-.20024-.29125-.60156-.35898-.88586-.14898-1.78476 1.3182-4.33297 3.18008-8.24859 6.02179-1.31445.95828-3.92266 3.26414-5.73539 3.23672-1.81336.0269-4.41867-2.2768-5.73539-3.23672-3.91515-2.8414-6.46359-4.70343-8.24859-6.02179-.2843-.21-.68562-.14227-.88586.14898l-.70875 1.03094a.62484368.62484368.0 00.14367.8568c1.78805 1.32023 4.33235 3.1789 8.2268 6.00531 1.5839 1.15476 4.41593 3.73539 7.20812 3.71664 2.79094.0189 5.62195-2.56024 7.20804-3.71664 3.89453-2.82649 6.43891-4.68516 8.2268-6.00531a.62484368.62484368.0 00.14367-.8568z" id="path2" style="stroke-width:.07812498"/></svg></span></a></div></div><p class=made-with-love><a href=https://github.com/humrochagf/colordrop><b>Colordrop</b>
</a><span>theme | Made </span><span>by</span>
<a href=https://humberto.io/><b>Humberto Rocha</b></a></p></footer></div><script src=/copy/copy.js></script><script src=/search/elasticlunr.min.js></script><script src=/search/search.js></script><script>loadSearch("https://www.andyibanez.com/index.json")</script></body></html>