<!doctype html><html prefix="og: http://ogp.me/ns#" lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,user-scalable=no"><meta http-equiv=x-ua-compatible content="ie=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=G-CE7T69YX8Y"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CE7T69YX8Y")}</script><link rel=icon type=image/png href=https://www.andyibanez.com/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://www.andyibanez.com/img/favicon-16x16.png sizes=16x16><link rel=canonical href=https://www.andyibanez.com/posts/using-corelocation-with-swiftui/><link rel=alternate hreflang=en href=https://www.andyibanez.com/posts/using-corelocation-with-swiftui/ title><meta name=description content="Learn how to use CoreLocation (and other frameworks) with SwiftUI"><meta name=author content><meta name=theme-color content="#292148"><meta itemprop=name content="Using CoreLocation With SwiftUI"><meta itemprop=description content="Learn how to use CoreLocation (and other frameworks) with SwiftUI"><meta itemprop=datePublished content="2021-03-17T07:00:00-04:00"><meta itemprop=dateModified content="2021-03-17T07:00:00-04:00"><meta itemprop=wordCount content="1332"><meta itemprop=keywords content="apple,swift,programming,swiftui,ios"><meta property="og:url" content="https://www.andyibanez.com/posts/using-corelocation-with-swiftui/"><meta property="og:site_name" content="Andy Ibanez"><meta property="og:title" content="Using CoreLocation With SwiftUI"><meta property="og:description" content="Learn how to use CoreLocation (and other frameworks) with SwiftUI"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-17T07:00:00-04:00"><meta property="article:modified_time" content="2021-03-17T07:00:00-04:00"><meta property="article:tag" content="Apple"><meta property="article:tag" content="Swift"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Swiftui"><meta property="article:tag" content="Ios"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using CoreLocation With SwiftUI"><meta name=twitter:description content="Learn how to use CoreLocation (and other frameworks) with SwiftUI"><meta name=twitter:creator content="@"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","url":"https://www.andyibanez.com/posts/using-corelocation-with-swiftui/","headline":"Using CoreLocation With SwiftUI","description":"Learn how to use CoreLocation (and other frameworks) with SwiftUI","datePublished":"2021-03-17","keywords":"apple,swift,programming,swiftui,ios","author":{"@type":"Person","name":""}}</script><title>Using CoreLocation With SwiftUI - Andy Ibanez</title><link rel=stylesheet href=https://www.andyibanez.com/style.main.min.18f604b90ed15864d7faa967f1ef9eacb99e1c967eff38762ec29b7bf1ab5876.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-CE7T69YX8Y"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CE7T69YX8Y")}</script></head><body><div class=wrapper><nav><div class=container><div class=language-selector></div></div></nav><header><div class=container><div class=header-group><div class=header-logo-container><a class=header-logo-link href=https://www.andyibanez.com/><img class=header-logo-circle src=https://www.andyibanez.com/img/andy_profile.png alt="Andy Ibanez logo"></a></div><div class=header-title><a href=https://www.andyibanez.com/>Andy Ibanez</a></div></div></div></header><nav><div class=container><div class=main-navigation><a href=/about/>About Me</a><a href=/posts/>Blog</a><a href=/projects/>Projects</a><a href=/tags/>Tags</a><a href=/contact/>Contact</a><a href=/privacy-policy/>Privacy policy</a></div></div></nav><div class=container><div class=search><input type=text id=searchInput placeholder="Type here to search"></div><div class="container search-results-container" hidden=true><div id=searchResults class=search-results></div></div></div><main><div class=container><article><h1 class=title>Using CoreLocation With SwiftUI</h1><p class=publish>Published on
<time class=post-date datetime=2021-03-17T07:00:00-04:00>March 17, 2021</time></p><p>SwiftUI forces us to change our way of thinking when building iOS apps. It makes us change from writing our apps in MVC to MVVM.</p><p>In this article, we will explore how SwiftUI can be used with certain frameworks that aren&rsquo;t &ldquo;SwiftUI ready&rdquo;. While this article uses CoreLocation as an example, keep in mind that you can use what you learn from this to integrate almost any other framework with SwiftUI, whether it is provided by Apple or not.</p><h1 id=understanding-the-complexities>Understanding the Complexities</h1><p>If you have tried to use SwiftUI with CoreLocation or similar frameworks that make use of a delegate, you may have found it to be very hard. Specifically, you may have found it that your core locations keep getting called over and over again with no clear reason.</p><p>One thing to keep in mind is that SwiftUI continuously creates and destroys views. When there is a state change, all views depending on it will be destroyed and recreated. This happens quite aggressively throughout the lifecycle of our SwiftUI apps.</p><p>To workaround this, SwiftUI provides us with specific property wrappers that store their values somewhere else rather than on the views directly. Two of such wrappers are <code>@StateObject</code> and <code>@ObservedObject</code>. What we need to do is to create a <code>ViewModel</code> that conforms to <code>ObservableObject</code>, and store all the relevant state there.</p><h1 id=writing-the-viewmodel>Writing the ViewModel</h1><p>We will create our view model for one view. This ViewModel will be responsible for receiving core location events. In turn, our ViewModel will expose <code>@Published</code> properties that our Views can observe and update accordingly.</p><p>We will start with a very barebones implementation, and we will call it <code>LocationViewModel</code>.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>class</span> <span style=color:#f9e2af>LocationViewModel</span>: NSObject, ObservableObject, CLLocationManagerDelegate {
</span></span><span style=display:flex><span>    @Published <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>authorizationStatus</span>: CLAuthorizationStatus
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>private</span> <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>locationManager</span>: CLLocationManager
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>override</span> <span style=color:#f38ba8>init</span>() {
</span></span><span style=display:flex><span>        locationManager = CLLocationManager()
</span></span><span style=display:flex><span>        authorizationStatus = locationManager.authorizationStatus
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#fab387>super</span>.<span style=color:#f38ba8>init</span>()
</span></span><span style=display:flex><span>        locationManager.delegate = <span style=color:#fab387>self</span>
</span></span><span style=display:flex><span>        locationManager.desiredAccuracy = kCLLocationAccuracyBest
</span></span><span style=display:flex><span>        locationManager.startUpdatingLocation()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For now, we will just expose the <code>authorizationStatus</code> as a <code>@Published</code> property. We will use this to manipulate our View depending on the authorization status.</p><p>I have written this tiny view to deal with the authorization status for location.</p><p><img src=/img/core_location_sample_init_view.png alt="Initial Location View"></p><p>If you are following along, feel free to use this starting code.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>struct</span> <span style=color:#f9e2af>ContentView</span>: View {
</span></span><span style=display:flex><span>    @StateObject <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>locationViewModel</span> = LocationViewModel()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>body</span>: some View {
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>switch</span> locationViewModel.authorizationStatus {
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>case</span> .notDetermined:
</span></span><span style=display:flex><span>            AnyView(RequestLocationView())
</span></span><span style=display:flex><span>                .environmentObject(locationViewModel)
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>case</span> .restricted:
</span></span><span style=display:flex><span>            ErrorView(errorText: <span style=color:#a6e3a1>&#34;Location use is restricted.&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>case</span> .denied:
</span></span><span style=display:flex><span>            ErrorView(errorText: <span style=color:#a6e3a1>&#34;The app does not have location permissions. Please enable them in settings.&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>case</span> .authorizedAlways, .authorizedWhenInUse:
</span></span><span style=display:flex><span>            TrackingView()
</span></span><span style=display:flex><span>                .environmentObject(locationViewModel)
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>default</span>:
</span></span><span style=display:flex><span>            Text(<span style=color:#a6e3a1>&#34;Unexpected status&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>struct</span> <span style=color:#f9e2af>RequestLocationView</span>: View {
</span></span><span style=display:flex><span>    @EnvironmentObject <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>locationViewModel</span>: LocationViewModel
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>body</span>: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Image(systemName: <span style=color:#a6e3a1>&#34;location.circle&#34;</span>)
</span></span><span style=display:flex><span>                .resizable()
</span></span><span style=display:flex><span>                .frame(width: <span style=color:#fab387>100</span>, height: <span style=color:#fab387>100</span>, alignment: .center)
</span></span><span style=display:flex><span>                .foregroundColor(<span style=color:#6c7086;font-style:italic>/*@START_MENU_TOKEN@*/</span>.blue<span style=color:#6c7086;font-style:italic>/*@END_MENU_TOKEN@*/</span>)
</span></span><span style=display:flex><span>            Button(action: {
</span></span><span style=display:flex><span>                <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;allowing perms&#34;</span>)
</span></span><span style=display:flex><span>            }, label: {
</span></span><span style=display:flex><span>                Label(<span style=color:#a6e3a1>&#34;Allow tracking&#34;</span>, systemImage: <span style=color:#a6e3a1>&#34;location&#34;</span>)
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>            .padding(<span style=color:#fab387>10</span>)
</span></span><span style=display:flex><span>            .foregroundColor(.white)
</span></span><span style=display:flex><span>            .background(Color.blue)
</span></span><span style=display:flex><span>            .clipShape(RoundedRectangle(cornerRadius: <span style=color:#fab387>8</span>))
</span></span><span style=display:flex><span>            Text(<span style=color:#a6e3a1>&#34;We need your permission to track you.&#34;</span>)
</span></span><span style=display:flex><span>                .foregroundColor(.gray)
</span></span><span style=display:flex><span>                .font(.caption)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>struct</span> <span style=color:#f9e2af>ErrorView</span>: View {
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>errorText</span>: <span style=color:#89dceb>String</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>body</span>: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Image(systemName: <span style=color:#a6e3a1>&#34;xmark.octagon&#34;</span>)
</span></span><span style=display:flex><span>		            .resizable()
</span></span><span style=display:flex><span>                .frame(width: <span style=color:#fab387>100</span>, height: <span style=color:#fab387>100</span>, alignment: .center)
</span></span><span style=display:flex><span>            Text(errorText)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .padding()
</span></span><span style=display:flex><span>        .foregroundColor(.white)
</span></span><span style=display:flex><span>        .background(Color.red)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>struct</span> <span style=color:#f9e2af>TrackingView</span>: View {
</span></span><span style=display:flex><span>    @EnvironmentObject <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>locationViewModel</span>: LocationViewModel
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>body</span>: some View {
</span></span><span style=display:flex><span>        Text(<span style=color:#a6e3a1>&#34;Thanks!&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=requesting-permission>Requesting Permission</h2><p>One important thing to always remember is that SwiftUI is all about updating state. So our ViewModel should update the variables our View is observing. It is not the case with CoreLocation, but for frameworks that have an asynchronous way to request permission, your ViewModel should handle all the asynchronous tasks and simply update state variables when it&rsquo;s done.</p><p>To request location access, start by adding these two methods to <code>LocationViewModel</code>:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>requestPermission</span>() {
</span></span><span style=display:flex><span>    locationManager.requestWhenInUseAuthorization()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>locationManagerDidChangeAuthorization</span>(<span style=color:#fab387>_</span> manager: CLLocationManager) {
</span></span><span style=display:flex><span>    authorizationStatus = manager.authorizationStatus
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Next, our Views should call <code>requestPermission</code>. It is perfectly acceptable to do this as a call to <code>onAppear</code>, but in this specific example we are prompting our user to tap a button, so we will call it as a response to a button action.</p><p>If you are following my code, <code>cmd + f</code> the word <code>allowing perms</code> and replace that <code>print</code> call with <code>locationViewModel.requestPermission()</code>.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>Button(action: {
</span></span><span style=display:flex><span>    locationViewModel.requestPermission()
</span></span><span style=display:flex><span>}, label: {
</span></span><span style=display:flex><span>    Label(<span style=color:#a6e3a1>&#34;Allow tracking&#34;</span>, systemImage: <span style=color:#a6e3a1>&#34;location&#34;</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>Now, when users tap our <code>Allow tracking</code> button, they will see the system prompt asking for permission. At this point, your <code>plist</code> file needs to be properly setup, so don&rsquo;t forget to add the <code>NSLocationWhenInUseUsageDescription</code> key to it with a string explanation your user why they need to grant you permission.</p><p><img src=/img/core_location_sample_location_prompt.png alt="System Location Prompt"></p><p>If you deny it, the view will automatically show the view explaining them the error. As you can see, this happens as soon as you tap a button on the system prompt. The delegate call, <code>locationManagerDidChangeAuthorization(_ manager: CLLocationManager)</code>, updates our <code>@Published</code> variable, which, since our View is updating, results in our view being rebuilt.</p><p><img src=/img/core_location_sample_perm_denied.png alt="Error View"></p><p>If you then change the permission in Settings to something else, the view will be rebuilt next time you launch the app. (<em>Note: for some reason, the simulator was not showing my app in Settings, this may also happen to you</em>).</p><p>For now, if you are running this code in the simulator, you can reset the permission settings running the following command on your Terminal, as explained in my <a href>Getting to Know the Simulator Better article</a>:</p><pre tabindex=0><code>xcrun simctl privacy booted reset all
</code></pre><p>Next time you relaunch the app, the permission will be reset and you will be able to see the prompt again.</p><p>When you see the prompt, give the app permission. You will simply see a text that says &ldquo;Thanks!&rdquo;, but we will implement the rest of the logic there now. We are not going to do anything complex, for now will just show some text with GPS data.</p><h2 id=showing-coordinates>Showing Coordinates</h2><p>Now that you have implemented the permission, implementing other methods is exactly the same thing. To show the coordinates in real time, create a <code>@Published</code> property in your ViewModel where you will store the <code>CLLocation</code> objects, and simply read them in your view.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>@Published <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>lastSeenLocation</span>: CLLocation?
</span></span><span style=display:flex><span>@Published <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>currentPlacemark</span>: CLPlacemark?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>// Methods</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>locationManager</span>(<span style=color:#fab387>_</span> manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {
</span></span><span style=display:flex><span>    lastSeenLocation = locations.<span style=color:#89dceb>first</span>
</span></span><span style=display:flex><span>    fetchCountryAndCity(<span style=color:#cba6f7>for</span>: locations.<span style=color:#89dceb>first</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>fetchCountryAndCity</span>(<span style=color:#cba6f7>for</span> location: CLLocation?) {
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>guard</span> <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>location</span> = location <span style=color:#cba6f7>else</span> { <span style=color:#cba6f7>return</span> }
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>geocoder</span> = CLGeocoder()
</span></span><span style=display:flex><span>    geocoder.reverseGeocodeLocation(location) { (placemarks, error) <span style=color:#cba6f7>in</span>
</span></span><span style=display:flex><span>        <span style=color:#fab387>self</span>.currentPlacemark = placemarks?.<span style=color:#89dceb>first</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then we can update <code>TrackingView</code> to show some data and update it in real time as we move around:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>struct</span> <span style=color:#f9e2af>TrackingView</span>: View {
</span></span><span style=display:flex><span>    @EnvironmentObject <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>locationViewModel</span>: LocationViewModel
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>body</span>: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            VStack {
</span></span><span style=display:flex><span>                PairView(
</span></span><span style=display:flex><span>                    leftText: <span style=color:#a6e3a1>&#34;Latitude:&#34;</span>,
</span></span><span style=display:flex><span>                    rightText: <span style=color:#89dceb>String</span>(coordinate?.latitude ?? <span style=color:#fab387>0</span>)
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                PairView(
</span></span><span style=display:flex><span>                    leftText: <span style=color:#a6e3a1>&#34;Longitude:&#34;</span>,
</span></span><span style=display:flex><span>                    rightText: <span style=color:#89dceb>String</span>(coordinate?.longitude ?? <span style=color:#fab387>0</span>)
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                PairView(
</span></span><span style=display:flex><span>                    leftText: <span style=color:#a6e3a1>&#34;Altitude&#34;</span>,
</span></span><span style=display:flex><span>                    rightText: <span style=color:#89dceb>String</span>(locationViewModel.lastSeenLocation?.altitude ?? <span style=color:#fab387>0</span>)
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                PairView(
</span></span><span style=display:flex><span>                    leftText: <span style=color:#a6e3a1>&#34;Speed&#34;</span>,
</span></span><span style=display:flex><span>                    rightText: <span style=color:#89dceb>String</span>(locationViewModel.lastSeenLocation?.speed ?? <span style=color:#fab387>0</span>)
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                PairView(
</span></span><span style=display:flex><span>                    leftText: <span style=color:#a6e3a1>&#34;Country&#34;</span>,
</span></span><span style=display:flex><span>                    rightText: locationViewModel.currentPlacemark?.country ?? <span style=color:#a6e3a1>&#34;&#34;</span>
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                PairView(leftText: <span style=color:#a6e3a1>&#34;City&#34;</span>, rightText: locationViewModel.currentPlacemark?.administrativeArea ?? <span style=color:#a6e3a1>&#34;&#34;</span>
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            .padding()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>coordinate</span>: CLLocationCoordinate2D? {
</span></span><span style=display:flex><span>        locationViewModel.lastSeenLocation?.coordinate
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As you move around, the coordinates, your speed, and altitude will update in real time through the <code>ViewModel</code>.</p><p>The code that gets the city name and country - <code>fetchCountryAndCity</code> is an asynchronous bit of code. I included it to show you that it doesn&rsquo;t really matter if the code is asynchronous, code-based, delegate based, or anything else. It all boils down to understanding how to separate your code from your View into a ViewModel. Avoid using asynchronous code in your views directly, and always use them in a view model instead.</p><p>The final product looks like this (I have manually censored it to avoid giving information about my current location):</p><p><img src=/img/core_location_swiftui_final_product.png alt="Final Product"></p><p>The completed sample projected can be downloaded from <a href=/archives/core_location_tests.zip>here</a>.</p><h1 id=conclusion>Conclusion</h1><p>SwiftUI forces us to think differently. In this article we explored how we can integrate CoreLocation with SwiftUI, but what we learned here can be used with other frameworks that are either delegate or closure based. Keep this in mind when you want to interact with other frameworks (CoreBluetooth, photo, etc).</p><p>The most important takeaway from this article is <strong>learn and understand when to use a ViewModel</strong>. If you are able to grasp the contents of this article, you will be able to integrate anything else (including Firebase!) in SwiftUI.</p></article></div></main><footer><div class=container><div class=footer-navigation><a href=https://github.com/AndyIbanez><span class=inline-svg><svg viewBox="0 0 42 40" id="svg4" width="42" height="40"><path fill="currentColor" d="m14.20936 32.20794c0 .16542-.19024.29776-.4301.29776-.27295.0248-.46319-.10752-.46319-.29776.0-.16542.19024-.29776.4301-.29776.24814-.0248.46319.10752.46319.29776zm-2.57234-.3722c-.0579.16542.10753.35566.35566.40528.21505.0827.46319.0.51282-.16542.0496-.16542-.10753-.35566-.35566-.4301-.21505-.0579-.45492.0248-.51282.19024zm3.65586-.14061c-.23986.0579-.40529.21505-.38047.40528.0248.16543.23986.27295.488.21505.23986-.0579.40528-.21505.38047-.38047-.0248-.15715-.24813-.26468-.488-.23986zM20.73531-.19734273e-6C9.2632-.19734273e-6.48748 8.7095398.48748 20.18166c0 9.17273 5.77328 17.02207 14.01964 19.78464 1.05871.19024 1.43091-.46319 1.43091-1.00081.0-.51282-.0248-3.34156-.0248-5.0785.0.0-5.78982 1.24067-7.00568-2.46481.0.0-.94292-2.40691-2.29939-3.02725.0.0-1.8941-1.29857.13234-1.27376.0.0 2.05952.16542 3.19267 2.13396 1.81139 3.19267 4.84691 2.27457 6.02969 1.72868.19023-1.32339.72786-2.24149 1.32338-2.78739-4.62358-.51281-9.28852-1.18278-9.28852-9.13964.0-2.27458.62861-3.416 1.95199-4.87172-.21505-.53763-.9181-2.7543.21506-5.6161302 1.72867-.53762 5.7071 2.2332202 5.7071 2.2332202 1.65424-.46319 3.43254-.70305 5.1943-.70305 1.76176.0 3.54006.23986 5.1943.70305.0.0 3.97843-2.7791202 5.7071-2.2332202 1.13315 2.8701002.4301 5.0785002.21505 5.6161302 1.32339 1.46399 2.13397 2.60542 2.13397 4.87172.0 7.98168-4.87172 8.61856-9.49531 9.13964.76095.65342 1.4061 1.8941 1.4061 3.83782.0 2.78739-.0248 6.23647-.0248 6.9147.0.53763.38047 1.19105 1.43091 1.00082 8.27117-2.74603 13.87903-10.59537 13.87903-19.7681C41.51252 8.7095398 32.20745-.19734273e-6 20.73533-.19734273e-6zM8.52706 28.52727c-.10752.0827-.0827.27295.0579.4301.13234.13234.32258.19024.4301.0827.10753-.0827.0827-.27295-.0579-.4301-.13233-.13234-.32257-.19024-.4301-.0827zM7.63378 27.8573c-.0579.10753.0248.23987.19023.32258.13234.0827.29777.0579.35566-.0579C8.23757 28.01446 8.15487 27.88212 7.98944 27.7994 7.82401 27.7498 7.69168 27.7746 7.63378 27.8573zm2.67986 2.94454c-.13234.10753-.0827.35566.10752.51281.19024.19024.4301.21505.53763.0827.10752-.10752.0579-.35566-.10753-.51281-.18196-.19024-.4301-.21505-.53762-.0827zM9.37072 29.58598c-.13234.0827-.13234.29776.0.488.13234.19023.35566.27295.46319.19023.13234-.10752.13234-.32257.0-.51281-.1158-.19024-.33085-.27295-.46319-.16542z" id="path2" style="stroke-width:.08271171"/></svg>
</span></a><a href=https://x.com/AndyIbanezK><span class=inline-svg><svg viewBox="0 0 50 40" id="svg4" width="50" height="40"><path fill="currentColor" d="m44.56253 9.96871c.0313.43748.0313.87506.0313 1.31254C44.59383 24.62494 34.43764 40 15.87508 40 10.1563 40 4.84383 38.34368.37506 35.4688c.81253.0937 1.5937.12495 2.4375.12495 4.71867.0 9.06249-1.5937 12.53125-4.31245-4.43751-.0938-8.15627-3.00003-9.43754-7.00006.62505.0937 1.25001.15622 1.90632.15622.90622.0 1.81254-.12505 2.65624-.34369C5.84384 23.15619 2.37498 19.09373 2.37498 14.18748v-.12495c1.3437.75 2.90633 1.21875 4.56246 1.28117-2.71876-1.81253-4.49993-4.90624-4.49993-8.40627.0-1.87497.4999-3.59372 1.37496-5.09373 4.96877 6.125 12.43756 10.12493 20.81248 10.56251-.15622-.75001-.25-1.53118-.25-2.31245C24.37495 4.5312 28.87498.0 34.46871.0c2.90623.0 5.53121 1.21875 7.37501 3.1875 2.28118-.43748 4.46867-1.28127 6.40626-2.43749-.75011 2.3438-2.34381 4.31255-4.43751 5.56246 2.03127-.21864 4.00003-.78126 5.81247-1.56244-1.37477 1.99992-3.09362 3.7811-5.06237 5.21868z" id="path2" style="stroke-width:.09619153"/></svg>
</span></a><a href=https://www.linkedin.com/in/andyibanez/><span class=inline-svg><svg viewBox="0 0 41 40" id="svg4" width="41" height="40"><path fill="currentColor" d="M9.45332 40H1.16028V13.29405H9.45332zM5.30234 9.65111c-2.65185.0-4.80279-2.19648-4.80279-4.84832a4.80279 4.80279.0 019.60558.0c0 2.65184-2.15184 4.84832-4.80279 4.84832zM40.49152 40H32.21633V26.99971c0-3.09828-.0625-7.07159-4.3117-7.07159-4.3117.0-4.97243 3.36615-4.97243 6.84837V40H14.64808V13.29405h7.95375v3.64294h.11608c1.10716-2.09827 3.81169-4.3126 7.8466-4.3126 8.39304.0 9.93594 5.52691 9.93594 12.70564V40z" id="path2" style="stroke-width:.08928771"/></svg>
</span></a><a href=https://www.andyibanez.com/blog/index.xml><span class=inline-svg><svg viewBox="0 0 40 40" id="svg4" width="40" height="40"><path fill="currentColor" d="m11.435816 34.282008c0 3.15793-2.5599899 5.71793-5.7179299 5.71793s-5.717840022654-2.56-5.717840022654-5.71793c0-3.15794 2.559990022654-5.71793 5.717930022654-5.71793s5.7178399 2.56008 5.7178399 5.71793zm15.68388 4.21873C26.373806 24.697208 15.317496 13.626978 1.4992361 12.880288.68361608 12.836188.46077346e-4 13.491538.46077346e-4 14.308318v4.29186c0 .75134.579460002654 1.38142 1.329190022654 1.43017 9.9849699.65036 17.9886099 8.63408 18.6402999 18.6403.0488.74973.67893 1.3292 1.43018 1.3292h4.29186c.81687 9e-5 1.47223-.68348 1.42812-1.49911zm12.87933.0257C39.249566 17.649718 22.452206.754048 1.4735261.00092799867.66727608-.027972.46077346e-4.623338.46077346e-4 1.430038v4.29177c0 .77008.610270002654 1.39687 1.379730022654 1.42848 17.0694999.6999 30.7701699 14.40316 31.4699899 31.46999.0315.76946.6583 1.37972 1.42848 1.37972h4.29177c.8066-8e-5 1.45794-.66731 1.42901-1.47356z" id="path2" style="stroke-width:.08928544"/></svg>
</span></a><a href=https://www.andyibanez.com/curriculum/><span class=inline-svg><svg viewBox="0 0 15680 20480" id="svg4" width="35" height="40"><path fill="currentColor" d="M11655.83 12824.48 7840.0001 16640.464 4024.17 12824.48c-2859.863 123.906-5143.7701 2463.775-5143.7701 5352.003v384.005c0 1059.853 859.96601 1919.512 1919.92167 1919.512H14879.678c1059.956.0 1919.922-859.659 1919.922-1919.512v-384.005c0-2888.228-2283.906-5228.097-5143.77-5352.003zM-575.64445 3193.1279l256.0032 59.9048v2335.7732c-279.9651 167.9381-479.9548 459.7818-479.9548 812.0422.0 335.8762 183.9639 615.9437 443.96075 787.9778l-623.9822 2491.9352c-67.9944 275.9716 84.02025 559.6229 303.9782 559.6229H996.31762c219.95798.0 371.97268-283.6513 303.97828-559.6229L676.31362 7188.8259c259.99685-172.0341 443.96078-452.1016 443.96078-787.9778.0-352.2604-199.98973-644.1041-479.95483-812.0422V3484.9716l2639.90503 635.9119c-344.0171 688.1366-559.9814 1456.1463-559.9814 2279.9646.0 2827.8113 2291.8942 5119.5519 5119.7569 5119.5519 2827.8619.0 5119.7569-2291.7406 5119.7569-5119.5519.0-823.8183-211.971-1591.828-559.982-2279.9646l3851.824-927.7556c727.971-176.1302 727.971-1083.9175.0-1260.0477L8635.9653 92.929226c-519.9937-123.905551-1067.943-123.905551-1587.9367.0L-575.64445 1928.9841c-723.92585 176.1302-723.92585 1088.0136.0 1264.1438z" id="path2" style="stroke-width:39.99821472"/></svg>
</span></a><a href=https://www.andyibanez.com/contact-me><span class=inline-svg><svg viewBox="0 0 40 40" id="svg4" width="40" height="40"><path fill="currentColor" d="m39.99999 36.249999c0 2.0711-1.6789 3.75-3.74999 3.75H3.75c-2.07109.0-3.74999-1.6789-3.74999-3.75v-20.56843a3.7499996 3.7499996.0 011.43648-2.95125c1.94633-1.5257 3.55476-2.7628904 12.82812-9.4930404C15.57906 2.2789186 18.18727-.02709136 20 .00024864227 21.81234-.02745136 24.42156 2.2793086 25.73539 3.2371986c9.27242 6.72945 10.88304 7.9683604 12.82812 9.4931204a3.7499996 3.7499996.0 011.43648 2.95125zm-5.13015-15.35976c-.20024-.29125-.60156-.35898-.88586-.14898-1.78476 1.3182-4.33297 3.18008-8.24859 6.02179-1.31445.95828-3.92266 3.26414-5.73539 3.23672-1.81336.0269-4.41867-2.2768-5.73539-3.23672-3.91515-2.8414-6.46359-4.70343-8.24859-6.02179-.2843-.21-.68562-.14227-.88586.14898l-.70875 1.03094a.62484368.62484368.0 00.14367.8568c1.78805 1.32023 4.33235 3.1789 8.2268 6.00531 1.5839 1.15476 4.41593 3.73539 7.20812 3.71664 2.79094.0189 5.62195-2.56024 7.20804-3.71664 3.89453-2.82649 6.43891-4.68516 8.2268-6.00531a.62484368.62484368.0 00.14367-.8568z" id="path2" style="stroke-width:.07812498"/></svg></span></a></div></div><p class=made-with-love><a href=https://github.com/humrochagf/colordrop><b>Colordrop</b>
</a><span>theme | Made </span><span>by</span>
<a href=https://humberto.io/><b>Humberto Rocha</b></a></p></footer></div><script src=/copy/copy.js></script><script src=/search/elasticlunr.min.js></script><script src=/search/search.js></script><script>loadSearch()</script></body></html>