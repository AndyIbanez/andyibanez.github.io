<!doctype html><html prefix="og: http://ogp.me/ns#" lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,user-scalable=no"><meta http-equiv=x-ua-compatible content="ie=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=G-CE7T69YX8Y"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CE7T69YX8Y")}</script><link rel=apple-touch-icon sizes=180x180 href=https://www.andyibanez.com/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png sizes=32x32 href=https://www.andyibanez.com/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.andyibanez.com/favicons/favicon-16x16.png><link rel=manifest href=https://www.andyibanez.com/favicons/site.webmanifest><link rel=mask-icon href=https://www.andyibanez.com/favicons/safari-pinned-tab.svg color=#292148><meta name=msapplication-TileColor content="#292148"><meta name=msapplication-config content="https://www.andyibanez.com/favicons/browserconfig.xml"><meta name=theme-color content="#292148"><link rel=canonical href=https://www.andyibanez.com/posts/sharing-data-apple-devices-multipeerconnectivity-framework/><link rel=alternate hreflang=en href=https://www.andyibanez.com/posts/sharing-data-apple-devices-multipeerconnectivity-framework/ title><meta name=description content="How to use the Speech framework to detect speech on iOS."><meta name=author content><meta name=theme-color content="#292148"><meta itemprop=name content="Sharing Data Across Apple Devices with the MultipeerConnectivity Framework"><meta itemprop=description content="How to use the Speech framework to detect speech on iOS."><meta itemprop=datePublished content="2020-07-15T07:00:00-04:00"><meta itemprop=dateModified content="2020-07-15T07:00:00-04:00"><meta itemprop=wordCount content="1800"><meta itemprop=keywords content="swift,ios,ipados,tvos,multipeerconnectivity"><meta property="og:url" content="https://www.andyibanez.com/posts/sharing-data-apple-devices-multipeerconnectivity-framework/"><meta property="og:site_name" content="Andy Ibanez"><meta property="og:title" content="Sharing Data Across Apple Devices with the MultipeerConnectivity Framework"><meta property="og:description" content="How to use the Speech framework to detect speech on iOS."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-15T07:00:00-04:00"><meta property="article:modified_time" content="2020-07-15T07:00:00-04:00"><meta property="article:tag" content="Swift"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Apple"><meta property="article:tag" content="Ios"><meta property="article:tag" content="Ipados"><meta property="article:tag" content="Tvos"><meta name=twitter:card content="summary"><meta name=twitter:title content="Sharing Data Across Apple Devices with the MultipeerConnectivity Framework"><meta name=twitter:description content="How to use the Speech framework to detect speech on iOS."><meta name=twitter:creator content="@"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","url":"https://www.andyibanez.com/posts/sharing-data-apple-devices-multipeerconnectivity-framework/","headline":"Sharing Data Across Apple Devices with the MultipeerConnectivity Framework","description":"How to use the Speech framework to detect speech on iOS.","datePublished":"2020-07-15","keywords":"swift,programming,apple,ios,ipados,tvos,multipeerconnectivity","author":{"@type":"Person","name":""}}</script><title>Sharing Data Across Apple Devices with the MultipeerConnectivity Framework - Andy Ibanez</title><link rel=stylesheet href=https://www.andyibanez.com/style.main.min.18f604b90ed15864d7faa967f1ef9eacb99e1c967eff38762ec29b7bf1ab5876.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-CE7T69YX8Y"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CE7T69YX8Y")}</script></head><body><div class=wrapper><nav><div class=container><div class=language-selector></div></div></nav><header><div class=container><div class=header-group><div class=header-logo-container><a class=header-logo-link href=https://www.andyibanez.com/><img class=header-logo-circle src=https://www.andyibanez.com/img/andy_profile.png alt="Andy Ibanez logo"></a></div><div class=header-title><a href=https://www.andyibanez.com/>Andy Ibanez</a></div></div></div></header><nav><div class=container><div class=main-navigation><a href=/about/>About Me</a><a href=/posts/>Blog</a><a href=/projects/>Projects</a><a href=/tags/>Tags</a><a href=/contact/>Contact</a><a href=/privacy-policy/>Privacy policy</a></div></div></nav><div class=container><div class=search><input type=text id=searchInput placeholder="Type here to search"></div><div class="container search-results-container" hidden=true><div id=searchResults class=search-results></div></div></div><main><div class=container><article><h1 class=title>Sharing Data Across Apple Devices with the MultipeerConnectivity Framework</h1><p class=publish>Published on
<time class=post-date datetime=2020-07-15T07:00:00-04:00>July 15, 2020</time></p><p>There are times when we may want to share data across instances of our app running on different physical devices. You could develop a server or even leverage cloud storage, but did you know Apple provides a framework to share data <em>directly</em> across devices, without having to use an intermediary? This framework is the MultipeerConnectivity framework, and it has actually been around for a while. In this article, we will explore this framework to understand how we can use it to share data across instances of our app in different devices directly.</p><h1 id=the-multipeerconnectivity-framework>The MultipeerConnectivity Framework.</h1><p>This framework is actually very old. It was introduced in iOS 7 all the way back in 2013. macOS later supported in OS X 10.10 Yosemite in 2014, and it&rsquo;s even supported by tvOS starting on tvOS 10.0. It supports a wide arrange of devices.</p><p>The framework allows you to send basically any kind of data, whether it is short strings of text or images.</p><h2 id=how-it-works>How It Works</h2><p>Before we dive deep into the code, we need to understand, superficially, the technologies it uses under the hood. This is important because you will be able to understand the capabilities and limitations of the framework in case you ever come across code that you expect to work, but doesn&rsquo;t.</p><p>What&rsquo;s important to know is that the framework can use different mediums to share data and not all devices support the same mediums.</p><h3 id=ios-support>iOS Support</h3><p>In iOS, the framework can use the following as the underlying medium for data sharing:</p><ul><li>Infrastructure Wi-Fi (AKA the Wi-Fi you have in your house).</li><li>Peer-to-peer Wi-Fi.</li><li>Bluetooth Personal Area Network (PANs).</li></ul><h3 id=macos-and-tvos>macOS and tvOS</h3><p>tvOS and macOS both support the same transport mechanisms:</p><ul><li>Infrastructure Wi-Fi</li><li>Peer-to-peer Wi-Fi</li><li>Ethernet</li></ul><h2 id=overall-architecture>Overall Architecture</h2><p>Devices cannot connect and send data to <em>any</em> device willy-nilly. Before two devices can share data, they need to establish a Session (a <a href=https://developer.apple.com/documentation/multipeerconnectivity/mcsession><code>MCSession</code></a> object) with each other.</p><p>To do this, one of the device becomes the advertiser and it starts broadcasting to nearby devices. It simply tells them &ldquo;hey all, I am willing to connect to one, as long as you guys are offering a session of this type. This is done with the <a href=https://developer.apple.com/documentation/multipeerconnectivity/mcnearbyserviceadvertiser><code>MCNearbyServiceAdvertiser</code></a>, object, or with the <a href=https://developer.apple.com/documentation/multipeerconnectivity/mcadvertiserassistant><code>MCAdvertiserAssistant</code></a> object. The only difference between these two objects is that the latter provides an UI to accept invitations. If you want to create your own UI to let your user manage their invitations, you can use the former.</p><p>Other apps can start looking for advertisers using the <a href=https://developer.apple.com/documentation/multipeerconnectivity/mcnearbyservicebrowser><code>MCNearbyServiceBrowser</code></a> or <a href=https://developer.apple.com/documentation/multipeerconnectivity/mcbrowserviewcontroller><code>MCBrowserViewController</code></a> objects. These two objects will let you see which devices are advertising the service type you want to connect to. Just like advertiser objects, the latter provides you with a standard UI, but you can build your own UI with the former if you want.</p><p>Finally, all apps running an instance of the app have a <a href=MCPeerID><code>MCPeerID</code></a> associated to them. This ID is unique to each device.</p><h2 id=playing-with-the-multipeerconnectivity-framework>Playing with the MultipeerConnectivity Framework</h2><p>With all that theory out of the way, it&rsquo;s time to write a bit of code. We will explore a few more concepts as we do, so you can understand better how to use this framework.</p><p>If you want to use the code here, you may want to get two devices. I will provide a sample project at the end that you can install on two devices so you can see them share data with each other.</p><h3 id=becoming-the-advertiser>Becoming the Advertiser</h3><p>We will explore how to become an advertiser using <code>MCNearbyServiceAdvertiser</code> first, as this gives us more control over the UI and experience when establishing a session.</p><p>Establishing an <code>MCSession</code> is a two-step progress. The first step is the <strong>discovery step</strong>. In the discovery step, a device can start looking for devices to connect to (advertisers who have a <code>MCNearbyNearbyAdvertiser</code> or <code>MCAdvertiserAssistant</code> currently advertising) using the <code>MCNearbyServiceBrowser</code> object.</p><p>Advertisers can start a session with code like this:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>advertiser</span>: MCNearbyServiceAdvertiser?
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>serviceType</span> = <span style=color:#a6e3a1>&#34;MPCTutorial&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>myId</span> = MCPeerID(displayName: UIDevice.current.name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>//...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>becomeAdvertiser</span>() {
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>discoveryInfo</span> = [
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>&#34;Device Type&#34;</span>: UIDevice.current.model,
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>&#34;OS&#34;</span>: UIDevice.current.systemName,
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>&#34;OS Version&#34;</span>: UIDevice.current.systemVersion
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    advertiser = MCNearbyServiceAdvertiser(peer: advertiserId, discoveryInfo: discoveryInfo, serviceType: serviceType)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    advertiser?.delegate = <span style=color:#fab387>self</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    advertiser?.startAdvertisingPeer()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There is a bit going on here. First, we create a dictionary called <code>discoveryInfo</code>. During the discovery step, before the devices have had the opportunity to establish a session, they can broadcast limited activity about themselves using this dictionary. In our case we are offering the device name, OS, and OS Version to be seen by other devices who want to connect to us. In certain scenarios this can help provide more information to the devices to ensure they connect to the right one.</p><p>When we create our <code>MCNearbyServiceAdvertiser</code> object, we need to pass in our <code>MCPeerID</code>. We create our peer ID also using the device name. The <code>discoveryInfo</code> is the same dictionary we defined earlier. Finally, the <code>serviceType</code> can be any string you want, as long as it is a maximum of 15 characters long, ASCII characters only, and/or hyphen.</p><p>You should only use the <code>init(displayName)</code> initializer when creating a peer locally. You can persist <code>MCPeerdID</code> long term to be used later on.</p><p>We assign the delegate to self. This is a <code>MCNearbyServiceAdvertiserDelegate</code> object that will receive events related to device discovery with devices coming to us. We will implement its only method in a bit.</p><p>We call <code>startAdvertisingPeer()</code> and we are ready to be seen by other devices. There is a matching <code>stopAdvertisingPeer()</code> we can use when we no longer want to be discoverable too.</p><h3 id=searching-for-devices-to-connect-to>Searching for devices to connect to</h3><p>As part of the <strong>discovery step</strong>, other devices start looking for advertisers. This can be done as easily as:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>myId</span> = MCPeerID(displayName: UIDevice.current.name)
</span></span><span style=display:flex><span><span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>browser</span>: MCNearbyServiceBrowser?
</span></span><span style=display:flex><span><span style=color:#f38ba8>var</span> <span style=color:#f5e0dc>connectedPeer</span>: MCPeerID?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>//...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>searchForDevices</span>() {
</span></span><span style=display:flex><span>    browser = MCNearbyServiceBrowser(peer: inviteeId, serviceType: serviceType)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    browser?.delegate = <span style=color:#fab387>self</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    browser?.startBrowsingForPeers()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We do not need to provide much info to browsers, as most of the info comes from advertisers. Set the delegate as it will receive all the events related to peer discovery. You can <code>startBrowsingForPeers()</code> and <code>stopBrowsingForPeers()</code> as you see fit.</p><p>Once you start browsing for peers, the browser will call two delegate methods:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>browser</span>(<span style=color:#fab387>_</span> browser: MCNearbyServiceBrowser, foundPeer peerID: MCPeerID, withDiscoveryInfo info: [<span style=color:#89dceb>String</span> : <span style=color:#89dceb>String</span>]?) {
</span></span><span style=display:flex><span>    <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;We found a peer!&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;ID: </span><span style=color:#a6e3a1>\(</span>peerID.displayName<span style=color:#a6e3a1>)</span><span style=color:#a6e3a1>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;Device Type: </span><span style=color:#a6e3a1>\(</span>info?[<span style=color:#a6e3a1>&#34;Device Type&#34;</span>] ?? <span style=color:#a6e3a1>&#34;&#34;</span><span style=color:#a6e3a1>)</span><span style=color:#a6e3a1>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;Version: </span><span style=color:#a6e3a1>\(</span>info?[<span style=color:#a6e3a1>&#34;OS Version&#34;</span>] ?? <span style=color:#a6e3a1>&#34;&#34;</span><span style=color:#a6e3a1>)</span><span style=color:#a6e3a1>&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>browser</span>(<span style=color:#fab387>_</span> browser: MCNearbyServiceBrowser, lostPeer peerID: MCPeerID) {
</span></span><span style=display:flex><span>    <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;We lost peer </span><span style=color:#a6e3a1>\(</span>peerID.displayName<span style=color:#a6e3a1>)</span><span style=color:#a6e3a1>&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So, one by one, you will receive information about peers that show up and peers that disappear, easy as that.</p><h3 id=inviting-devices-to-connect-to-us>Inviting devices to connect to us</h3><p>We are following the manual approach in this article, so we will do the manual connecting process.</p><p>Once we find a peer we want to connect to (with <code>browser(foundPeer:peerID:withDiscoveryInfo</code>), we need to create a <code>MCSession</code>. We use this object to connect to other peers.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>invitePeerToConnect</span>(peerID: MCPeerID) {
</span></span><span style=display:flex><span>    session = MCSession(peer: myId)
</span></span><span style=display:flex><span>    session?.delegate = <span style=color:#fab387>self</span>
</span></span><span style=display:flex><span>    <span style=color:#fab387>self</span>.connectedPeer = peerID
</span></span><span style=display:flex><span>    browser?.invitePeer(peerID, to: session!, withContext: <span style=color:#fab387>nil</span>, timeout: <span style=color:#fab387>30</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You need to set the session delegate to receive events regarding the session, including when the session state changes and when you receive any data.</p><p>A bit of discussion on <code>MCSession</code> is in order. <code>MCSession</code> has more than one initializer. The second initializer can be used to create secure and encrypted communication channels between both devices. We will not discuss &ldquo;secure&rdquo; <code>MCSession</code>s in this article, but be aware of the <code>init(peer:securityIdentity:encryptionPreference</code> initializer, as there may need a case in which you need to verify a peer and/or you&rsquo;ll have the need to share encrypted information. Encryption handling is very transparent. MCEncryptionPreference is just an enum, and you can use encryption without verifying the peer. in iOS 9 and above, it will require encryption by default.</p><p>the <code>context</code> parameter is an optional data that you can use to pass anything to provide even more context. <strong>Do not send any sensitive data with this</strong>. The connection has not been established yet, so if you are using encryption, this particular piece of data will not be encrypted.</p><p>When you invite an advertiser to connect, the <code>advertiser</code> delegate will call the <code>advertiser(didReceiveInvitationFromPeer peerID:context:invitationHandler</code> delegate method.</p><p>In this example, we will immediately accept the invitation to connect:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>advertiser</span>(<span style=color:#fab387>_</span> advertiser: MCNearbyServiceAdvertiser, didReceiveInvitationFromPeer peerID: MCPeerID, withContext context: Data?, invitationHandler: @escaping (<span style=color:#89dceb>Bool</span>, MCSession?) -&gt; <span style=color:#89dceb>Void</span>) {
</span></span><span style=display:flex><span>    <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;Invitation to connect from </span><span style=color:#a6e3a1>\(</span>peerID.displayName<span style=color:#a6e3a1>)</span><span style=color:#a6e3a1>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;Accepting invite&#34;</span>)
</span></span><span style=display:flex><span>    session = MCSession(peer: advertiserId)
</span></span><span style=display:flex><span>    invitationHandler(<span style=color:#fab387>true</span>, session)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=sharing-data---the-session-phase>Sharing Data - The Session Phase.</h3><p>After the advertiser has accepted the invite, the session phase will start. When the connection state has changed, the <code>session(peer:didChange)</code> delegate method of <code>MCSession</code> gets called. When the state is <code>.connected</code>, we are ready to send data.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>sendImage</span>(toPeer peer: MCPeerID) {
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>bundledImage</span> = Bundle.main.url(forResource: <span style=color:#a6e3a1>&#34;cucoo&#34;</span>, withExtension: <span style=color:#a6e3a1>&#34;png&#34;</span>)<span style=color:#89dceb;font-weight:700>!</span>
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>imageData</span> = <span style=color:#cba6f7>try</span>! Data(contentsOf: bundledImage)
</span></span><span style=display:flex><span>    DispatchQueue.main.asyncAfter(deadline: .now() <span style=color:#89dceb;font-weight:700>+</span> .seconds(<span style=color:#fab387>5</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>try</span>! <span style=color:#fab387>self</span>.session?.send(imageData, toPeers: [peer], with: .reliable)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>On the receiving device, the <code>session(_:didReceive:fromPeer:)</code> from peer will get called, and you can process the image then.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>session</span>(<span style=color:#fab387>_</span> session: MCSession, didReceive data: Data, fromPeer peerID: MCPeerID) {
</span></span><span style=display:flex><span>    <span style=color:#89dceb>print</span>(<span style=color:#a6e3a1>&#34;Did receive data&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>if</span> <span style=color:#f38ba8>let</span> <span style=color:#f5e0dc>imageData</span> = UIImage(data: data) {
</span></span><span style=display:flex><span>        DispatchQueue.main.async {
</span></span><span style=display:flex><span>            <span style=color:#fab387>self</span>.imageView.image = imageData
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The session can receive other kinds of information as well, and it even supports streaming!</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>session</span>(<span style=color:#fab387>_</span> session: MCSession, didReceive stream: InputStream, withName streamName: <span style=color:#89dceb>String</span>, fromPeer peerID: MCPeerID) {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>session</span>(<span style=color:#fab387>_</span> session: MCSession, didStartReceivingResourceWithName resourceName: <span style=color:#89dceb>String</span>, fromPeer peerID: MCPeerID, with progress: Progress) {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>func</span> <span style=color:#89b4fa>session</span>(<span style=color:#fab387>_</span> session: MCSession, didFinishReceivingResourceWithName resourceName: <span style=color:#89dceb>String</span>, fromPeer peerID: MCPeerID, at localURL: URL?, withError error: Error?) {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=sample-project>Sample Project</h1><p>I have created a sample project of everything here. You can download it from <a href=/archives/MultipeerApp.zip>here</a>. You need to install it on two devices to see how it works. The UI simply contains three buttons: One to become an advertiser, one to search for devices, and another to send a default image. When you search for a peer, it will automatically send an invite to the first device it sees. After you tap &ldquo;Search for Devices&rdquo;, wait a few seconds and tap &ldquo;send image&rdquo; on either device. A glorious image of a cucoo will show up on the destination device.</p><h1 id=conclusion>Conclusion</h1><p>MultipeerConnectivity provides an easy interface to share data between devices. It will automatically choose the right medium to send data. There&rsquo; a few things to keep in mind:</p><ul><li>It currently supports 8 peers connected at the same time.</li><li>When the state changes to <code>.connected</code>, the connection only lasts a bit when idle. You should try to send data as soon as the connection is established.</li><li>We can get it to work with Bonjour and other APIs if we do manual peer management. That is out of the scope of this article.</li></ul><h1 id=conclusion-1>Conclusion</h1><p>Reflection is a very interesting feature that allows to create some sort of <em>meta-programming</em> in Swift. While not applicable to many use cases, it&rsquo;s important to be aware of its existence.</p></article></div></main><footer><div class=container><div class=footer-navigation><a href=https://github.com/AndyIbanez><span class=inline-svg><svg viewBox="0 0 42 40" id="svg4" width="42" height="40"><path fill="currentColor" d="m14.20936 32.20794c0 .16542-.19024.29776-.4301.29776-.27295.0248-.46319-.10752-.46319-.29776.0-.16542.19024-.29776.4301-.29776.24814-.0248.46319.10752.46319.29776zm-2.57234-.3722c-.0579.16542.10753.35566.35566.40528.21505.0827.46319.0.51282-.16542.0496-.16542-.10753-.35566-.35566-.4301-.21505-.0579-.45492.0248-.51282.19024zm3.65586-.14061c-.23986.0579-.40529.21505-.38047.40528.0248.16543.23986.27295.488.21505.23986-.0579.40528-.21505.38047-.38047-.0248-.15715-.24813-.26468-.488-.23986zM20.73531-.19734273e-6C9.2632-.19734273e-6.48748 8.7095398.48748 20.18166c0 9.17273 5.77328 17.02207 14.01964 19.78464 1.05871.19024 1.43091-.46319 1.43091-1.00081.0-.51282-.0248-3.34156-.0248-5.0785.0.0-5.78982 1.24067-7.00568-2.46481.0.0-.94292-2.40691-2.29939-3.02725.0.0-1.8941-1.29857.13234-1.27376.0.0 2.05952.16542 3.19267 2.13396 1.81139 3.19267 4.84691 2.27457 6.02969 1.72868.19023-1.32339.72786-2.24149 1.32338-2.78739-4.62358-.51281-9.28852-1.18278-9.28852-9.13964.0-2.27458.62861-3.416 1.95199-4.87172-.21505-.53763-.9181-2.7543.21506-5.6161302 1.72867-.53762 5.7071 2.2332202 5.7071 2.2332202 1.65424-.46319 3.43254-.70305 5.1943-.70305 1.76176.0 3.54006.23986 5.1943.70305.0.0 3.97843-2.7791202 5.7071-2.2332202 1.13315 2.8701002.4301 5.0785002.21505 5.6161302 1.32339 1.46399 2.13397 2.60542 2.13397 4.87172.0 7.98168-4.87172 8.61856-9.49531 9.13964.76095.65342 1.4061 1.8941 1.4061 3.83782.0 2.78739-.0248 6.23647-.0248 6.9147.0.53763.38047 1.19105 1.43091 1.00082 8.27117-2.74603 13.87903-10.59537 13.87903-19.7681C41.51252 8.7095398 32.20745-.19734273e-6 20.73533-.19734273e-6zM8.52706 28.52727c-.10752.0827-.0827.27295.0579.4301.13234.13234.32258.19024.4301.0827.10753-.0827.0827-.27295-.0579-.4301-.13233-.13234-.32257-.19024-.4301-.0827zM7.63378 27.8573c-.0579.10753.0248.23987.19023.32258.13234.0827.29777.0579.35566-.0579C8.23757 28.01446 8.15487 27.88212 7.98944 27.7994 7.82401 27.7498 7.69168 27.7746 7.63378 27.8573zm2.67986 2.94454c-.13234.10753-.0827.35566.10752.51281.19024.19024.4301.21505.53763.0827.10752-.10752.0579-.35566-.10753-.51281-.18196-.19024-.4301-.21505-.53762-.0827zM9.37072 29.58598c-.13234.0827-.13234.29776.0.488.13234.19023.35566.27295.46319.19023.13234-.10752.13234-.32257.0-.51281-.1158-.19024-.33085-.27295-.46319-.16542z" id="path2" style="stroke-width:.08271171"/></svg>
</span></a><a href=https://x.com/AndyIbanezK><span class=inline-svg><svg viewBox="0 0 50 40" id="svg4" width="50" height="40"><path fill="currentColor" d="m44.56253 9.96871c.0313.43748.0313.87506.0313 1.31254C44.59383 24.62494 34.43764 40 15.87508 40 10.1563 40 4.84383 38.34368.37506 35.4688c.81253.0937 1.5937.12495 2.4375.12495 4.71867.0 9.06249-1.5937 12.53125-4.31245-4.43751-.0938-8.15627-3.00003-9.43754-7.00006.62505.0937 1.25001.15622 1.90632.15622.90622.0 1.81254-.12505 2.65624-.34369C5.84384 23.15619 2.37498 19.09373 2.37498 14.18748v-.12495c1.3437.75 2.90633 1.21875 4.56246 1.28117-2.71876-1.81253-4.49993-4.90624-4.49993-8.40627.0-1.87497.4999-3.59372 1.37496-5.09373 4.96877 6.125 12.43756 10.12493 20.81248 10.56251-.15622-.75001-.25-1.53118-.25-2.31245C24.37495 4.5312 28.87498.0 34.46871.0c2.90623.0 5.53121 1.21875 7.37501 3.1875 2.28118-.43748 4.46867-1.28127 6.40626-2.43749-.75011 2.3438-2.34381 4.31255-4.43751 5.56246 2.03127-.21864 4.00003-.78126 5.81247-1.56244-1.37477 1.99992-3.09362 3.7811-5.06237 5.21868z" id="path2" style="stroke-width:.09619153"/></svg>
</span></a><a href=https://www.linkedin.com/in/andyibanez/><span class=inline-svg><svg viewBox="0 0 41 40" id="svg4" width="41" height="40"><path fill="currentColor" d="M9.45332 40H1.16028V13.29405H9.45332zM5.30234 9.65111c-2.65185.0-4.80279-2.19648-4.80279-4.84832a4.80279 4.80279.0 019.60558.0c0 2.65184-2.15184 4.84832-4.80279 4.84832zM40.49152 40H32.21633V26.99971c0-3.09828-.0625-7.07159-4.3117-7.07159-4.3117.0-4.97243 3.36615-4.97243 6.84837V40H14.64808V13.29405h7.95375v3.64294h.11608c1.10716-2.09827 3.81169-4.3126 7.8466-4.3126 8.39304.0 9.93594 5.52691 9.93594 12.70564V40z" id="path2" style="stroke-width:.08928771"/></svg>
</span></a><a href=https://www.andyibanez.com/posts/index.xml><span class=inline-svg><svg viewBox="0 0 40 40" id="svg4" width="40" height="40"><path fill="currentColor" d="m11.435816 34.282008c0 3.15793-2.5599899 5.71793-5.7179299 5.71793s-5.717840022654-2.56-5.717840022654-5.71793c0-3.15794 2.559990022654-5.71793 5.717930022654-5.71793s5.7178399 2.56008 5.7178399 5.71793zm15.68388 4.21873C26.373806 24.697208 15.317496 13.626978 1.4992361 12.880288.68361608 12.836188.46077346e-4 13.491538.46077346e-4 14.308318v4.29186c0 .75134.579460002654 1.38142 1.329190022654 1.43017 9.9849699.65036 17.9886099 8.63408 18.6402999 18.6403.0488.74973.67893 1.3292 1.43018 1.3292h4.29186c.81687 9e-5 1.47223-.68348 1.42812-1.49911zm12.87933.0257C39.249566 17.649718 22.452206.754048 1.4735261.00092799867.66727608-.027972.46077346e-4.623338.46077346e-4 1.430038v4.29177c0 .77008.610270002654 1.39687 1.379730022654 1.42848 17.0694999.6999 30.7701699 14.40316 31.4699899 31.46999.0315.76946.6583 1.37972 1.42848 1.37972h4.29177c.8066-8e-5 1.45794-.66731 1.42901-1.47356z" id="path2" style="stroke-width:.08928544"/></svg>
</span></a><a href=https://www.andyibanez.com/contact><span class=inline-svg><svg viewBox="0 0 40 40" id="svg4" width="40" height="40"><path fill="currentColor" d="m39.99999 36.249999c0 2.0711-1.6789 3.75-3.74999 3.75H3.75c-2.07109.0-3.74999-1.6789-3.74999-3.75v-20.56843a3.7499996 3.7499996.0 011.43648-2.95125c1.94633-1.5257 3.55476-2.7628904 12.82812-9.4930404C15.57906 2.2789186 18.18727-.02709136 20 .00024864227 21.81234-.02745136 24.42156 2.2793086 25.73539 3.2371986c9.27242 6.72945 10.88304 7.9683604 12.82812 9.4931204a3.7499996 3.7499996.0 011.43648 2.95125zm-5.13015-15.35976c-.20024-.29125-.60156-.35898-.88586-.14898-1.78476 1.3182-4.33297 3.18008-8.24859 6.02179-1.31445.95828-3.92266 3.26414-5.73539 3.23672-1.81336.0269-4.41867-2.2768-5.73539-3.23672-3.91515-2.8414-6.46359-4.70343-8.24859-6.02179-.2843-.21-.68562-.14227-.88586.14898l-.70875 1.03094a.62484368.62484368.0 00.14367.8568c1.78805 1.32023 4.33235 3.1789 8.2268 6.00531 1.5839 1.15476 4.41593 3.73539 7.20812 3.71664 2.79094.0189 5.62195-2.56024 7.20804-3.71664 3.89453-2.82649 6.43891-4.68516 8.2268-6.00531a.62484368.62484368.0 00.14367-.8568z" id="path2" style="stroke-width:.07812498"/></svg></span></a></div></div><p class=made-with-love><a href=https://github.com/humrochagf/colordrop><b>Colordrop</b>
</a><span>theme | Made </span><span>by</span>
<a href=https://humberto.io/><b>Humberto Rocha</b></a></p></footer></div><script src=/copy/copy.js></script><script src=/search/elasticlunr.min.js></script><script src=/search/search.js></script><script>loadSearch("https://www.andyibanez.com/index.json")</script></body></html>